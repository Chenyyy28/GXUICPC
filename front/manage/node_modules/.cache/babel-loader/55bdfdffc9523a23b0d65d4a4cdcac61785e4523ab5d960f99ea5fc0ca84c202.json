{"ast":null,"code":"import { ref, reactive } from 'vue';\n// Element-Plus的依赖采用的是自动导入，所以这里无需显示的引入，其他地方的element-plus引用同理\nimport { ElMessage } from 'element-plus';\n// import request from '@/utils/request';      //这里使用自行封装的axios，下文已给出，照搬后修改运行端口即可\nimport { useRouter } from 'vue-router';\nimport axios from 'axios';\nimport store from '@/store';\nimport router from '@/router';\n\n// const checkCodeUrl = \"api/checkCode?\" + new Date().getTime();\n//表单\n\nexport default {\n  __name: 'Login',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const formDataRef = ref();\n    let formData = reactive({\n      username: \"\",\n      password: \"\"\n    });\n    const rules = {\n      username: [{\n        required: true,\n        message: \"请输入用户名\"\n      }],\n      password: [{\n        required: true,\n        message: \"请输入密码\"\n      }]\n      // checkCode: [{\n      //     required: true,\n      //     message: \"请输入验证码\"\n      // }],\n    };\n\n    // const router = useRouter();\n    const login = async () => {\n      var form_obj = JSON.parse(JSON.stringify(formData));\n      await axios.post(\"/url/login\", form_obj).then(res => res.data).then(res => {\n        if (res.code === 200) {\n          ElMessage({\n            message: '登录成功',\n            type: 'success'\n          });\n          localStorage.clear();\n          localStorage.setItem(\"isLogin\", res.data.token);\n          localStorage.setItem(\"username\", res.data.username);\n        } else {\n          ElMessage.error('账号或密码错误！！！登录失败！！！');\n        }\n      }).then(() => {\n        axios.get(\"/url/route\").then(res => res.data).then(data => {\n          return data.data;\n        }).then(data => {\n          console.log(\"1111\");\n          localStorage.setItem('routeLists', data);\n          return data;\n        }).then(data => {\n          console.log(\"2222\");\n          let routeLists = data;\n          routeLists.forEach(route => {\n            router.addRoute(\"MainPage\", {\n              path: route.link,\n              name: route.pageName,\n              component: () => import('@/components/' + route.pageName)\n            });\n          });\n        }).then(() => {\n          console.log(router.options.routes);\n\n          // router.push(\"/\");\n        }).catch(e => {\n          ElMessage.error('账号或密码错误！！！登录失败！！！');\n        });\n      }).then(() => {});\n    };\n    const __returned__ = {\n      formDataRef,\n      get formData() {\n        return formData;\n      },\n      set formData(v) {\n        formData = v;\n      },\n      rules,\n      login,\n      ref,\n      reactive,\n      get ElMessage() {\n        return ElMessage;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get axios() {\n        return axios;\n      },\n      get store() {\n        return store;\n      },\n      get router() {\n        return router;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","reactive","ElMessage","useRouter","axios","store","router","formDataRef","formData","username","password","rules","required","message","login","form_obj","JSON","parse","stringify","post","then","res","data","code","type","localStorage","clear","setItem","token","error","get","console","log","routeLists","forEach","route","addRoute","path","link","name","pageName","component","options","routes","catch","e"],"sources":["C:/Users/18725/Desktop/集训队管理系统开发/manage/front/manage/src/views/Login.vue"],"sourcesContent":["<template>\r\n    <div class=\"login-body\">\r\n        <div class=\"login-panel\">\r\n            <div class=\"login-title\">用户登录</div>\r\n            <el-form :model=\"formData\" :rules=\"rules\" ref=\"formDataRef\">\r\n                <el-form-item prop=\"username\">\r\n                    <el-input placeholder=\"请输入账号\" v-model=\"formData.username\" size=\"large\" type=\"text\">\r\n                        <template #prefix>\r\n                            <el-icon>\r\n                                <i-ep-user />\r\n                            </el-icon>\r\n                        </template>\r\n                    </el-input>\r\n                </el-form-item>\r\n                <el-form-item prop=\"password\">\r\n                    <el-input placeholder=\"请输入密码\" v-model=\"formData.password\" size=\"large\" type=\"password\"\r\n                        @keydown.enter=\"login()\">\r\n                        <template #prefix>\r\n                            <el-icon>\r\n                                <i-ep-lock />\r\n                            </el-icon>\r\n                        </template>\r\n                    </el-input>\r\n                </el-form-item>\r\n                <!-- <el-form-item label=\"\">\r\n                    <div class=\"check-code-panel\">\r\n                        <el-input placeholder=\"请输入验证码\" v-model=\"formData.checkCode\" class=\"input-panel\" />\r\n                        <img src=\"checkCodeUrl\" class=\"check-code\">\r\n                    </div>\r\n                </el-form-item> -->\r\n                <!-- <el-form-item label=\"\">\r\n                    <el-checkbox label=\"记住密码\" name=\"type\" />\r\n                </el-form-item> -->\r\n                <el-form-item label=\"\">\r\n                    <el-button type=\"primary\" style=\"width: 100%;\" @click=\"login()\" size=\"large\">登录</el-button>\r\n                </el-form-item>\r\n            </el-form>\r\n        </div>\r\n    </div>\r\n</template>\r\n​\r\n<script setup>\r\nimport { ref, reactive } from 'vue'\r\n// Element-Plus的依赖采用的是自动导入，所以这里无需显示的引入，其他地方的element-plus引用同理\r\nimport { ElMessage } from 'element-plus';\r\n// import request from '@/utils/request';      //这里使用自行封装的axios，下文已给出，照搬后修改运行端口即可\r\nimport { useRouter } from 'vue-router';\r\nimport axios from 'axios';\r\nimport store from '@/store';\r\nimport router from '@/router';\r\n\r\n\r\n// const checkCodeUrl = \"api/checkCode?\" + new Date().getTime();\r\n//表单\r\nconst formDataRef = ref();\r\nlet formData = reactive({\r\n    username: \"\",\r\n    password: \"\"\r\n});\r\nconst rules = {\r\n    username: [{\r\n        required: true,\r\n        message: \"请输入用户名\"\r\n    }],\r\n    password: [{\r\n        required: true,\r\n        message: \"请输入密码\"\r\n    }],\r\n    // checkCode: [{\r\n    //     required: true,\r\n    //     message: \"请输入验证码\"\r\n    // }],\r\n}\r\n\r\n// const router = useRouter();\r\nconst login = async () => {\r\n    var form_obj = JSON.parse(JSON.stringify(formData));\r\n    await axios.post(\"/url/login\", form_obj).then(res => res.data).then(res => {\r\n        if (res.code === 200) {\r\n            ElMessage({\r\n                message: '登录成功',\r\n                type: 'success',\r\n            })\r\n            localStorage.clear();\r\n            localStorage.setItem(\"isLogin\", res.data.token);\r\n            localStorage.setItem(\"username\", res.data.username);\r\n        } else {\r\n            ElMessage.error('账号或密码错误！！！登录失败！！！')\r\n        }\r\n    }).then(() => {\r\n        axios.get(\"/url/route\").then(res => res.data).then(data => {\r\n            return data.data;\r\n        }).then((data) => {\r\n            console.log(\"1111\");\r\n            localStorage.setItem('routeLists', data);\r\n            return data;\r\n        }).then((data) => {\r\n            console.log(\"2222\");\r\n            \r\n            let routeLists = data;\r\n            routeLists.forEach(route => {\r\n                router.addRoute(\"MainPage\", {\r\n                    path: route.link,\r\n                    name: route.pageName,\r\n                    component: () => import('@/components/' + route.pageName)\r\n                })\r\n            })\r\n        }).then(() => {\r\n            console.log(router.options.routes);\r\n            \r\n            // router.push(\"/\");\r\n        }).catch(e => {\r\n            ElMessage.error('账号或密码错误！！！登录失败！！！')\r\n        })\r\n    }).then(() => {\r\n\r\n    });\r\n};\r\n\r\n\r\n</script>\r\n​\r\n<style scoped>\r\n.login-body {\r\n    background: url(\"../assets/bac.jpg\") no-repeat center center;\r\n    height: 100%;\r\n    width: 100%;\r\n    background-size: cover;\r\n    position: absolute;\r\n    left: 0;\r\n    top: 0;\r\n}\r\n\r\n.login-title {\r\n    font-size: 22px;\r\n    text-align: center;\r\n    margin-bottom: 22px;\r\n}\r\n\r\n.login-panel {\r\n    position: absolute;\r\n    top: 0;\r\n    bottom: 0;\r\n    left: 0;\r\n    right: 0;\r\n    margin: auto;\r\n    padding: 25px;\r\n    width: 26%;\r\n    min-width: 460px;\r\n    height: 30%;\r\n    min-height: 300px;\r\n    background: rgba(255, 255, 255, 0.6);\r\n    border-radius: 5%;\r\n    box-shadow: 2px 2px 10px #ddd;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}